@model AutoAdsWebApp.Models.ProfileViewModel
@{
    ViewBag.Title = "Личный кабинет";
}

<div class="container mt-4">
    <div class="row">
        <!-- Левая панель - меню -->
        <div class="col-md-3">
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <div class="mb-3">
                        <i class="bi bi-person-circle" style="font-size: 4rem; color: #6c757d;"></i>
                    </div>
                    <h4>@User.Identity.Name</h4>
                    <p class="text-muted">
                        @if (User.IsInRole("Admin"))
                        {
                            <span>Администратор</span>
                        }
                        else
                        {
                            <span>Пользователь</span>
                        }
                    </p>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item nav-item active" data-section="reviews">
                        <i class="bi bi-chat-left-text me-2"></i>Мои отзывы
                    </li>
                    <li class="list-group-item nav-item" data-section="settings">
                        <i class="bi bi-gear me-2"></i>Настройки
                    </li>
                    <li class="list-group-item nav-item" data-section="ads">
                        <i class="bi bi-megaphone me-2"></i>Моя реклама
                    </li>
                    <li class="list-group-item">
                        <a href="@Url.Action("Logout", "Account")" class="text-decoration-none text-dark">
                            <i class="bi bi-box-arrow-right me-2"></i>Выйти
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Основное содержимое -->
        <div class="col-md-9" id="profileContent">
            <!-- Сюда будет подгружаться контент -->
            <div class="text-center p-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Загрузка...</span>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .list-group-item {
            transition: all 0.3s;
            cursor: pointer;
        }

            .list-group-item:hover {
                background-color: #f8f9fa;
            }

        .card {
            border-radius: 10px;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .text-warning {
            color: #ffc107 !important;
        }
    </style>
}

@section Scripts {
    <script>
        $(document).ready(function() {
            // Загрузка секции
            function loadSection(section) {
                $('.nav-item').removeClass('active');
                $(`[data-section="${section}"]`).addClass('active');

                $('#profileContent').html(`
                    <div class="text-center p-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Загрузка...</span>
                        </div>
                    </div>
                `);

                $.get(`/Account/Load${section.charAt(0).toUpperCase() + section.slice(1)}`, function(data) {
                    $('#profileContent').html(data);
                    initSectionScripts(section);
                });
            }

            // Инициализация скриптов для секции
            function initSectionScripts(section) {
                if (section === 'reviews') {
                    initReviewsScripts();
                } else if (section === 'settings') {
                    initSettingsScripts();
                }
            }

            // Скрипты для секции отзывов
            function initReviewsScripts() {
                $('#addReviewForm').submit(function(e) {
                    e.preventDefault();
                    $.ajax({
                        url: $(this).attr('action'),
                        type: 'POST',
                        data: $(this).serialize(),
                        success: function(response) {
                            if (response.success) {
                                alert('Отзыв отправлен на модерацию!');
                                loadSection('reviews');
                            }
                        }
                    });
                });

                $('.delete-review').click(function() {
                    if (confirm('Вы уверены, что хотите удалить этот отзыв?')) {
                        const reviewId = $(this).closest('.review-item').data('id');
                        $.post('@Url.Action("DeleteReview", "Account")', {
                            id: reviewId,
                            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                        }, function() {
                            loadSection('reviews');
                        });
                    }
                });
            }

            // Скрипты для секции настроек
            function initSettingsScripts() {
                $('#settingsForm').submit(function(e) {
                    e.preventDefault();
                    $.ajax({
                        url: $(this).attr('action'),
                        type: 'POST',
                        data: $(this).serialize(),
                        success: function(response) {
                            if (response.success) {
                                alert(response.message);
                            }
                        }
                    });
                });
            }

            // Обработчики кликов по меню
            $('.nav-item').click(function() {
                const section = $(this).data('section');
                loadSection(section);
            });

            // Загружаем отзывы по умолчанию
            loadSection('reviews');
        });
    </script>
}